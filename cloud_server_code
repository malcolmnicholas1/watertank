Server URL: https://stem-iot-receiver.us-south.cf.appdomain.cloud/

[{"id":"98bc43d.f38764","type":"function","z":"7e005615.a27da8","name":"Add timestamp","func":"msg.payload.d.timestamp = Date.now();\nmsg.payload.d.distanceToWater = parseInt(msg.payload.d.value,10)\nreturn msg;\n","outputs":1,"noerr":0,"x":400,"y":120,"wires":[["f1c30e9d.e6bd3","2f4d47c6.00be28"]]},{"id":"26398f97.d72be8","type":"ibmiot in","z":"7e005615.a27da8","authentication":"quickstart","apiKey":"","inputType":"evt","logicalInterface":"","ruleId":"","deviceId":"96e1c253.b9ff7","applicationId":"","deviceType":"+","eventType":"+","commandType":"","format":"json","name":"IBM IoT","service":"quickstart","allDevices":"","allApplications":"","allDeviceTypes":true,"allLogicalInterfaces":"","allEvents":true,"allCommands":"","allFormats":"","qos":0,"x":160,"y":120,"wires":[["98bc43d.f38764"]]},{"id":"f1c30e9d.e6bd3","type":"cloudant out","z":"7e005615.a27da8","name":"Store Measurement","cloudant":"","database":"measurements","service":"STEM-IoT-Receiver-cloudantNoSQLDB","payonly":true,"operation":"insert","x":730,"y":180,"wires":[]},{"id":"2f4d47c6.00be28","type":"function","z":"7e005615.a27da8","name":"Calculate Volume","func":"var tankHeight = 200\nvar tankRadius = 150\nvar tankVolume = 0;\nvar airHeight = 0;\nvar airVolume = 0;\nvar waterVolume = 0;\nvar waterVolumePercentage = 0;\n\ntankVolume = Math.PI*(tankRadius*tankRadius)*tankHeight;\n\nairHeight = msg.payload.d.distanceToWater;\n\nif (airHeight == -1) {\n    airHeight = tankHeight / 2;\n}\nairVolume = Math.PI*(tankRadius*tankRadius)*airHeight;\n\nwaterVolume = (tankVolume - airVolume).toFixed(2);\nwaterVolumePercentage = Math.floor((waterVolume/tankVolume)*100);\n\nmsg.payload.d.waterVolume = waterVolume;\nmsg.payload.d.waterVolumePercentage = waterVolumePercentage;\n\nreturn msg;","outputs":1,"noerr":0,"x":730,"y":260,"wires":[["25ed65ae.d43dd2"]]},{"id":"25ed65ae.d43dd2","type":"function","z":"7e005615.a27da8","name":"Get percentage","func":"msg.payload = msg.payload.d.waterVolumePercentage;\nreturn msg;","outputs":1,"noerr":0,"x":1060,"y":260,"wires":[["d2615209.ce7498","e35f832.db061"]]},{"id":"d2615209.ce7498","type":"ui_gauge","z":"7e005615.a27da8","name":"Water Volume Gauge","group":"a166acf5.3ed43","order":0,"width":0,"height":0,"gtype":"gage","title":"Water Volume","label":"Percentage Total Volume","format":"{{value}}","min":0,"max":"100","colors":["#ff2600","#e6e600","#00b500"],"seg1":"30","seg2":"60","x":1340,"y":260,"wires":[]},{"id":"e35f832.db061","type":"debug","z":"7e005615.a27da8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1050,"y":120,"wires":[]},{"id":"a166acf5.3ed43","type":"ui_group","z":"","name":"Water Meter","tab":"cc4bd8b7.262c6","disp":true,"width":"6","collapse":false},{"id":"cc4bd8b7.262c6","type":"ui_tab","z":"","name":"Home","icon":"dashboard","disabled":false,"hidden":false}]
